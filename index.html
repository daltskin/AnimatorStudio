<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Animator Studio</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Caveat:wght@400;600&family=Courier+Prime:wght@400;700&family=DM+Serif+Display&family=Fira+Code:wght@400;600&family=IBM+Plex+Mono:wght@400;600&family=Inter:wght@400;500;600;700&family=Lobster&family=Lora:wght@400;600&family=Merriweather:wght@400;700&family=Montserrat:wght@400;600&family=Nunito:wght@400;600&family=Pacifico&family=Permanent+Marker&family=Playfair+Display:wght@400;600&family=Poppins:wght@400;600&family=Raleway:wght@400;600&family=Roboto:wght@400;700&family=Shadows+Into+Light&family=Source+Sans+Pro:wght@400;600&family=Work+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="app-brand">
            <img src="images/logo_small.png" alt="Animator Studio logo displayed as a small icon featuring animation-themed imagery" style="max-height: 25px; transform: rotate(-15deg);" />
          <h1>Animator Studio</h1>
        </div>
        <div class="header-actions">
          <button type="button" id="clearCanvas" class="ghost" title="Clear the entire canvas">Clear canvas</button>
          <details class="export-menu action-group">
            <summary class="menu-button" aria-haspopup="listbox" title="Open sharing and export options">Share &amp; export</summary>
            <div class="menu-list" role="listbox">
              <button type="button" id="importScene" class="ghost" role="option" title="Import a saved scene">Import scene</button>
              <input type="file" id="importSceneInput" accept="application/json" hidden />
              <button type="button" id="exportScene" class="ghost" role="option" title="Export the current scene as JSON">Export scene (.json)</button>
              <button type="button" id="exportGif" class="ghost" role="option" title="Export an animated GIF">Export GIF</button>
              <button type="button" id="exportMp4" class="ghost" role="option" title="Export an MP4 video">Export MP4</button>
              <p id="exportStatus" data-variant="idle" aria-live="polite">Exporter standing by</p>
            </div>
          </details>
        </div>
      </header>

      <div class="workspace">
        <aside class="toolbar" aria-label="Editor controls">
              <div class="toolbar-section">
                <div class="toolbar-section-header">
                  <h2>Appearance</h2>
                  <button
                    type="button"
                    class="toolbar-toggle tool-menu-toggle icon-only"
                    data-toolbar-toggle
                    aria-pressed="false"
                    aria-label="Hide toolbar"
                    title="Hide the toolbar"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="collapse">
                      <path d="M14 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="expand">
                      <path d="M10 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                </div>
                <div class="workspace">
                  <div class="control color-controls" role="group" aria-label="Fill and stroke colours">
                    <label class="color-control">
                      <span class="control-label">Fill</span>
                      <input type="color" id="fillColor" value="#ff6b6b" title="Pick the fill colour" />
                    </label>
                    <label class="color-control">
                      <span class="control-label">Stroke</span>
                      <input type="color" id="strokeColor" value="#1f2937" title="Pick the stroke colour" />
                    </label>
                  </div>
                  <label class="control">
                    <span class="control-label">Stroke width</span>
                    <input type="range" id="strokeWidth" min="1" max="12" value="3" title="Adjust stroke width" />
                    <span id="strokeWidthValue" class="value">3px</span>
                  </label>
                  <div class="control icon-toggle-group" id="strokeStyleControl">
                    <span class="control-label">Stroke style</span>
                    <div class="icon-toggle-row" role="radiogroup" aria-label="Stroke style">
                      <button type="button" class="icon-toggle selected" data-stroke-style="solid" aria-pressed="true" title="Draw solid outlines">
                        <span class="sr-only">Solid stroke</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 12h16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle" data-stroke-style="dashed" aria-pressed="false" title="Draw dashed outlines">
                        <span class="sr-only">Dashed stroke</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 12h4m4 0h4m4 0h0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="8 6"></path>
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle" data-stroke-style="dotted" aria-pressed="false" title="Draw dotted outlines">
                        <span class="sr-only">Dotted stroke</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 12h0m4 0h0m4 0h0m4 0h0m4 0h0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="control icon-toggle-group" id="sketchControl">
                    <span class="control-label">Sketchiness</span>
                    <div class="icon-toggle-row" role="radiogroup" aria-label="Sketchiness">
                        <button type="button" class="icon-toggle selected" data-sketch-level="0" aria-pressed="true" title="Architect straight lines">
                          <span class="sr-only">Architect</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 12h16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </button>
                        <button type="button" class="icon-toggle" data-sketch-level="1" aria-pressed="false" title="Artist slight overbrushed lines">
                          <span class="sr-only">Artist</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 12c3 0 3-4 6-4s3 4 6 4 3-4 6-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </button>
                        <button type="button" class="icon-toggle" data-sketch-level="2" aria-pressed="false" title="Cartoonist heavier overbrushed lines">
                          <span class="sr-only">Cartoonist</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M4 11.5c2 3 4-3 6-1.5s2 4.5 4 3 2-4 4-2 2 4 4 1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="control icon-toggle-group" id="fillStyleControl">
                    <span class="control-label">Fill style</span>
                    <div class="icon-toggle-row" role="radiogroup" aria-label="Fill style">
                      <button type="button" class="icon-toggle" data-fill-style="solid" aria-pressed="false" title="Use a solid fill">
                        <span class="sr-only">Solid fill</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <rect x="6" y="6" width="12" height="12" rx="2" fill="currentColor" />
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle selected" data-fill-style="cross-hatch" aria-pressed="true" title="Fill with cross-hatch pattern">
                        <span class="sr-only">Cross-hatch fill</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <rect x="6" y="6" width="12" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
                          <path d="M8 8l8 8m0-8l-8 8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle" data-fill-style="hachure" aria-pressed="false" title="Fill with angled hatch lines">
                        <span class="sr-only">Hachure fill</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <rect x="6" y="6" width="12" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
                          <path d="M8 18l8-8M10 18l8-8M12 18l8-8" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="control icon-toggle-group" id="edgeStyleControl">
                    <span class="control-label">Edge style</span>
                    <div class="icon-toggle-row" role="radiogroup" aria-label="Edge style">
                      <button type="button" class="icon-toggle" data-edge-style="sharp" aria-pressed="false" title="Draw sharp corners">
                        <span class="sr-only">Sharp corners</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <rect x="6" y="6" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="miter" />
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle selected" data-edge-style="round" aria-pressed="true" title="Use rounded corners">
                        <span class="sr-only">Rounded corners</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <rect x="6" y="6" width="12" height="12" rx="4" ry="4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <label class="control">
                    <span class="control-label">Opacity</span>
                    <input type="range" id="opacity" min="0" max="100" value="100" title="Adjust fill opacity" />
                    <span id="opacityValue" class="value">100%</span>
                  </label>
                  <label class="control">
                    <span class="control-label">Font family</span>
                    <select id="fontFamily" title="Choose the font for text shapes">
                      <option value="Excalifont" selected>Excalifont â€” Hand-drawn Sans</option>
                      <option value="Inter">Inter â€” Clean Sans</option>
                      <option value="Poppins">Poppins â€” Rounded Sans</option>
                      <option value="Roboto">Roboto â€” Classic Sans</option>
                      <option value="Montserrat">Montserrat â€” Geometric Sans</option>
                      <option value="Source Sans Pro">Source Sans Pro â€” UI Sans</option>
                      <option value="Work Sans">Work Sans â€” Friendly Sans</option>
                      <option value="Nunito">Nunito â€” Soft Sans</option>
                      <option value="Raleway">Raleway â€” Elegant Sans</option>
                      <option value="Merriweather">Merriweather â€” Reading Serif</option>
                      <option value="Lora">Lora â€” Warm Serif</option>
                      <option value="Playfair Display">Playfair Display â€” Editorial Serif</option>
                      <option value="DM Serif Display">DM Serif Display â€” Deco Serif</option>
                      <option value="Caveat">Caveat â€” Handwritten</option>
                      <option value="Shadows Into Light">Shadows Into Light â€” Casual Hand</option>
                      <option value="Amatic SC">Amatic SC â€” Tall Hand</option>
                      <option value="Pacifico">Pacifico â€” Script</option>
                      <option value="Lobster">Lobster â€” Retro Script</option>
                      <option value="Permanent Marker">Permanent Marker â€” Graffiti</option>
                      <option value="IBM Plex Mono">IBM Plex Mono â€” Technical Mono</option>
                      <option value="Fira Code">Fira Code â€” Coding Mono</option>
                      <option value="Courier Prime">Courier Prime â€” Classic Mono</option>
                    </select>
                  </label>
                  <div class="control icon-toggle-group arrow-ending-control" id="arrowEndingControl" hidden>
                    <span class="control-label">Arrow endings</span>
                    <div class="icon-toggle-row" role="group" aria-label="Arrow endings">
                      <button type="button" class="icon-toggle" data-arrow-toggle="start" aria-pressed="false" title="Toggle arrowhead at the start of the line">
                        <span class="sr-only">Toggle arrowhead at start</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M8 12l6-4v3h6v2h-6v3z" fill="currentColor" />
                          <path d="M4 12h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </button>
                      <button type="button" class="icon-toggle" data-arrow-toggle="end" aria-pressed="true" title="Toggle arrowhead at the end of the line">
                        <span class="sr-only">Toggle arrowhead at end</span>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                          <path d="M16 12l-6 4v-3H4v-2h6V8z" fill="currentColor" />
                          <path d="M20 12h-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>

                </div>

                <div class="toolbar-section">
                  <button
                    type="button" 
                    id="tipsToggle" 
                    class="toolbar-toggle icon-only"
                    title="Show helpful tips for new users"
                  >
                    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                      <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" />
                      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                      <circle cx="12" cy="8" r="1" fill="currentColor" />
                    </svg>
                  </button>
                </div>
        </aside>

        <section class="stage-area">
          <div class="canvas-wrapper">
            <div class="floating-tool-menu" aria-label="Canvas tools and actions">
              <div class="tool-cluster" role="radiogroup" aria-label="Shape tools">
                <button data-tool="select" class="tool-button selected" aria-pressed="true" aria-label="Select tool" title="Select existing shapes">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M6.5 4.25l5.05 12.19 1.62-3.73 3.83 3.83 1.77-1.77-3.83-3.83 3.73-1.62L6.5 4.25z" fill="currentColor" />
                  </svg>
                  <span class="tool-label">Select</span>
                </button>
                <button data-tool="rectangle" class="tool-button" aria-pressed="false" aria-label="Rectangle tool" title="Draw a rectangle">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <rect x="4" y="7" width="16" height="10" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.8" />
                  </svg>
                  <span class="tool-label">Rectangle</span>
                </button>
                <button data-tool="diamond" class="tool-button" aria-pressed="false" aria-label="Diamond tool" title="Draw a diamond">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M12 3l8 9-8 9-8-9z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                  </svg>
                  <span class="tool-label">Diamond</span>
                </button>
                <button data-tool="square" class="tool-button" aria-pressed="false" aria-label="Square tool" title="Draw a square">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <rect x="6" y="6" width="12" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.8" />
                  </svg>
                  <span class="tool-label">Square</span>
                </button>
                <button data-tool="circle" class="tool-button" aria-pressed="false" aria-label="Circle tool" title="Draw a circle">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <circle cx="12" cy="12" r="6" fill="none" stroke="currentColor" stroke-width="1.8" />
                  </svg>
                  <span class="tool-label">Circle</span>
                </button>
                <button data-tool="line" class="tool-button" aria-pressed="false" aria-label="Line tool" title="Draw a straight line">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M5 12h14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                  </svg>
                  <span class="tool-label">Line</span>
                </button>
                <button data-tool="arrow" class="tool-button" aria-pressed="false" aria-label="Arrow tool" title="Draw an arrow connector">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M5 12h9.17l-3.58-3.59L12 7l6 6-6 6-1.41-1.41L14.17 13H5z" fill="currentColor" />
                  </svg>
                  <span class="tool-label">Arrow</span>
                </button>
                <button data-tool="free" class="tool-button" aria-pressed="false" aria-label="Free draw tool" title="Sketch freehand lines">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M4.3 15.6l4.3 4.3 10.3-10.3-4.3-4.3z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                    <path d="M4.3 15.6L3 20.5l4.9-1.3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M10.6 13.7l-3.3-3.3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                  </svg>
                  <span class="tool-label">Free draw</span>
                </button>
                <button data-tool="text" class="tool-button" aria-pressed="false" aria-label="Text tool" title="Add text">
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M6 5h12v2h-5v12h-2V7H6z" fill="currentColor" />
                  </svg>
                  <span class="tool-label">Text</span>
                </button>
              </div>
              <span class="tool-divider" aria-hidden="true"></span>
              <div class="tool-cluster" role="group" aria-label="Grouping actions">
                <button type="button" id="groupShapes" class="tool-button" aria-label="Group selection" title="Group selected shapes" disabled>
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <rect x="5" y="6" width="10" height="10" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.6" />
                    <rect x="9" y="10" width="10" height="10" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.6" />
                  </svg>
                  <span class="tool-label">Group</span>
                </button>
                <button type="button" id="ungroupShapes" class="tool-button" aria-label="Ungroup selection" title="Ungroup selected shapes" disabled>
                  <svg class="tool-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <rect x="5" y="6" width="8" height="8" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.6" />
                    <rect x="11" y="12" width="8" height="8" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.6" />
                    <path d="M9.5 10.5l5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span class="tool-label">Ungroup</span>
                </button>
              </div>
              <button
                type="button"
                class="toolbar-toggle tool-menu-toggle icon-only"
                data-tool-menu-toggle
                aria-pressed="false"
                aria-label="Hide canvas tools"
                title="Hide canvas tools"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="collapse">
                  <path d="M6 14l6-6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="expand">
                  <path d="M6 10l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </button>
            </div>
            <div class="stage-surface">
              <div class="floating-toolbar-menu">
                <button
                  type="button"
                  class="toolbar-toggle toolbar-toggle-floating icon-only"
                  data-toolbar-toggle
                  aria-pressed="false"
                  aria-label="Show toolbar"
                  title="Show the toolbar"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="collapse">
                    <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="expand">
                    <path d="M9 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </button>
              </div>
              <canvas id="stage" width="800" height="600" role="application" aria-label="Animation canvas"></canvas>
              <div id="stageDimensions" class="stage-dimensions" aria-live="polite">1280 Ã— 720 px</div>
              <div class="zoom-controls">
                <button type="button" id="zoomIn" class="zoom-button" aria-label="Zoom in" title="Zoom in (Ctrl + Mouse wheel up)">
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2" />
                    <path d="M8 11h6M11 8v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    <path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </button>
                <button type="button" id="zoomOut" class="zoom-button" aria-label="Zoom out" title="Zoom out (Ctrl + Mouse wheel down)">
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2" />
                    <path d="M8 11h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    <path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </button>
                <button type="button" id="zoomReset" class="zoom-button zoom-reset" aria-label="Reset zoom" title="Reset zoom to 100%">
                  <span class="zoom-level">100%</span>
                </button>
              </div>
              <button type="button" id="stageResizeHandle" class="stage-resize-handle stage-resize-handle--corner" data-stage-resize="corner" aria-label="Resize canvas" title="Drag to resize the canvas">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M8 16l8-8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                  <path d="M11 19l8-8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                </svg>
              </button>
              <div id="marqueeOverlay" class="marquee-overlay" hidden aria-hidden="true"></div>
              <div class="floating-timeline-menu">
                <button
                  type="button"
                  class="toolbar-toggle timeline-toggle-floating icon-only"
                  data-timeline-toggle
                  aria-pressed="false"
                  aria-label="Show timeline"
                  title="Show the timeline"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="collapse">
                    <path d="M18 15l-6-6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="expand">
                    <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </button>
              </div>

              <div class="floating-tips-panel" id="floatingTipsPanel" style="display: none;" aria-label="Helpful tips">
                <div class="tips-header">
                  <h3>Tips for New Users</h3>
                  <button type="button" id="tipsClose" class="icon-only" title="Close tips">
                    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                      <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
                <ul id="tipsList"></ul>
                <div class="tips-footer" id="tipsFooter" style="display: none;">
                  <button type="button" id="tipsReset" class="ghost" title="Reset all tips to see them again">
                    Reset all tips
                  </button>
                </div>
              </div>
            </div>
          </div>

          <section class="timeline" aria-label="Animation timeline">
            <header class="timeline-header">
              <div class="timeline-controls">
                <div class="timeline-controls-left">
                  <button id="playToggle" class="primary" title="Play or pause the animation">Play</button>
                  <button id="stopPlayback" class="ghost" title="Stop playback and reset">Stop</button>
                  <button id="addKeyframe" class="ghost" disabled title="Add a keyframe at the current time">Add keyframe</button>
                  <button id="deleteKeyframe" class="ghost" disabled title="Delete keyframe at the current time">Delete keyframe</button>
                </div>
                <button
                  type="button"
                  class="toolbar-toggle timeline-toggle icon-only"
                  data-timeline-toggle
                  aria-pressed="false"
                  aria-label="Hide timeline"
                  title="Hide the timeline"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="collapse">
                    <path d="M18 15l-6-6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-icon="expand">
                    <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </button>
              </div>
              <div class="timeline-info">
                <label class="control compact">
                  <span>Duration</span>
                  <input type="number" id="timelineDuration" min="1" value="5" title="Change the animation duration" />
                  <span class="suffix">s</span>
                </label>
                <label class="toggle-checkbox" id="loopToggleLabel">
                  <input type="checkbox" id="loopToggle" checked title="Loop playback" />
                  <span class="toggle-checkbox__state">Loop</span>
                </label>
                <label class="toggle-checkbox" id="bounceToggleLabel">
                  <input type="checkbox" id="bounceToggle" title="Bounce playback back and forth" />
                  <span class="toggle-checkbox__state">Bounce</span>
                </label>
                <label class="control compact">
                  <span>Export FPS</span>
                  <input type="number" id="exportFps" min="1" max="60" value="25" title="Set frames per second for exports" />
                </label>
                <div class="time-display">
                  <span id="currentTime">0.0s</span>
                </div>
              </div>
            </header>

            <div class="timeline-body">
              <input type="range" id="timelineRange" min="0" max="1000" value="0" title="Scrub through the animation timeline" />
              <div class="timeline-track" id="timelineTrack">
                <div class="timeline-marker" style="left: 0%"></div>
              </div>
              <div class="keyframe-panel">
                <h3>Keyframes</h3>
                <div id="keyframeList" class="keyframe-list" aria-live="polite"></div>
              </div>
            </div>
          </section>
        </section>
      </div>
    </div>

    <div id="stageContextMenu" class="context-menu" role="menu" hidden aria-hidden="true">
      <button type="button" data-stage-action="paste" role="menuitem" title="Paste (Ctrl+V)">
        <span class="context-menu__icon">ðŸ“‹</span>
        Paste
      </button>
      <div class="context-menu__divider"></div>
      <div class="context-menu__section">
        <label class="context-menu__label" for="stageBackgroundColor">Stage background</label>
        <input type="color" id="stageBackgroundColor" value="#ffffff" aria-label="Pick stage background colour" />
      </div>
      <button type="button" data-stage-action="reset-background" role="menuitem">Reset background colour</button>
      <label class="toggle-checkbox context-menu__toggle">
        <input type="checkbox" id="backgroundGrid" title="Show background grid" />
        <span class="toggle-checkbox__state">Background grid</span>
      </label>
    </div>

    <div id="shapeContextMenu" class="context-menu" role="menu" hidden aria-hidden="true">
      <button type="button" data-z-action="bring-forward" role="menuitem">Bring forward</button>
      <button type="button" data-z-action="send-backward" role="menuitem">Send backward</button>
      <button type="button" data-z-action="bring-to-front" role="menuitem">Bring to front</button>
      <button type="button" data-z-action="send-to-back" role="menuitem">Send to back</button>
    </div>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: false, theme: 'default' });
      window.mermaid = mermaid;
    </script>
    <script type="module" src="app.js"></script>
  </body>
</html>
